# This file is sourced by Xsession(5), not executed.
# Copyright (c) 2013 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

if [ "$DESKTOP_SESSION" = 'ubuntu' ]; then
    # Get RELEASE from croutonversion
    croutonversion="/usr/local/bin/croutonversion"
    RELEASE="unknown"
    if [ -f "$croutonversion" ]; then
        RELEASE="`awk -F"'" '/^RELEASE=/{print $2;exit}' "$croutonversion"`"
    fi

    # If on trusty, launch unity-panel-service and indicators
    if [ "$RELEASE" = 'trusty' ]; then
        launch_list='/usr/lib/unity/unity-panel-service'
        autostart_files="$XDG_CONFIG_DIRS/autostart/"*

        for f in $autostart_files; do
            # Only indicators managed by upstart in Unity are marked with
            # NotShowIn=Unity;
            if grep -q '^NotShowIn=Unity;$' "$f"; then
                # Parse out Exec= and add to launch list
                launch_list="$launch_list `awk -F"'" '/^Exec=/{print $2;exit}' "$f"`"
            fi
        done

        # Launch everything in launch_list
        for e in $launch_list; do
            $e >/dev/null 2>&1 &
        done
    fi
fi
